<!DOCTYPE html>
<html>
    <head>
        <script src = 'urlParameters.js'></script>
        <script>
            function setTitle(str) {
                document.title = `Slack | ${str}`;
            }

            function setDisplay(ID, value) {
                document.getElementById(ID).style.display = value;
            }

            function toggleCollapse(t) {
                let contentID = t.id.split('Title').join('Content');
                let titleMaxID = t.id + 'Max';
                let titleMinID = t.id + 'Min';

                if (document.getElementById(contentID).style.display === 'none') {
                    setDisplay(contentID, 'block');
                    setDisplay(titleMaxID, 'block');
                    setDisplay(titleMinID, 'none');
                } else {
                    setDisplay(contentID, 'none');
                    setDisplay(titleMaxID, 'none');
                    setDisplay(titleMinID, 'block');
                }
            }

        </script>
        <script async type = "module">
            const { jml, jml_nester } = await import('./jml.mjs');
            const { applyWidgetJml } = await import ('./widgetJml.mjs');
            const { channelsWidgetJml } = await import('./channelsWidget.mjs');
            const { loadJSON } = await import('./loadJSON.mjs');

            const map = await loadJSON('./VIEWERDATA_map.json');
            const archiveName = Object.keys(map)[0];

            const channelsArr = await loadJSON(`./VIEWERDATA/${archiveName}/channels.json`);
            const usersArr = await loadJSON(`./VIEWERDATA/${archiveName}/users.json`)

            init(channelsArr);

            async function init(chans) {
                setTitle(archiveName)
                document.querySelector('#heading').innerHTML = archiveName;

                let data = {
                    channelsArr: channelsArr,
                    usersArr: usersArr,
                }
                applyWidgetJml(channelsWidgetJml, data, '#channels');
            }

        </script>
        <link rel="stylesheet" href="main.css">
    </head>
    <body>
        <h1 id = 'heading'></h1>
        <div id = 'channels'></div>
    </body>
</html>